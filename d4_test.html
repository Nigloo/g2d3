<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D4 Test</title>
        <style>
            .axis path,
            .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }

            .axis text {
                font-family: sans-serif;
                font-size: 11px;
            }
        </style>
        <script type="text/javascript" src="d3.v3.js"></script>
        <script type="text/javascript" src="d4.js"></script>
        <script type="text/javascript">
            
            "use strict";
            
            var G = [];
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var dataset = [
                {col1:5,    col2:5,     col3:300,   col4:0},
                {col1:10,   col2:20,    col3:1200,  col4:1},
                {col1:20,   col2:3,     col3:3000,  col4:2},
                {col1:40,   col2:17,    col3:6000,  col4:3}];
            
            G['1'] = d4.graphic()
            .element({  x:function(d){return d.col1;},
                        y:'data:col2',
                        stroke_width:function(d,i){return d.col4+1;},
                        stroke:function(d,i){return d.col4;},
                        fill:'none'})
            .line({     stroke_width:3,
                        stroke:function(){return 'blue';},
                        interpolation:'cardinal',
                        stroke_linecap:'round'})
            .symbol({   size:function(d){var r = 5*(d.col4+1)+5; return 3.1415*r*r;},
                        fill:'yellow',
                        fill_opacity:0.5})
            .symbol({   x:10,
                        y:10,
                        stroke_width:function(d){return d.col4%2==0?10:3;},
                        stroke:function(d){return Math.exp(d.col4);},
                        stroke_opacity:function(d){return (d.col4+1)/4;},
                        size:'data:col3',
                        stroke_dasharray:function(d){var a=1+d.col4*2;return 2*a+','+a;}})
            .data({data:dataset})
            .plot({selector:"#graph1", width:1024, height:768, margin:50});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var dataset = [];
            var cat1 = ['A', 'B'];
            var cat2 = [10, 20];
            
            for(var i = 0 ; i < cat1.length ; i++) {
                for(var j = 0 ; j < cat2.length ; j++) {
                    for(var k = 0 ; k < 5 ; k++) {
                        dataset.push({col1:cat1[i], col2:cat2[j], col3:k, col4:Math.random()*2});
                        dataset.push({col1:cat1[i], col2:cat2[j], col3:k, col4:2+Math.random()*2});
                    }
                }
            }
            dataset.sort(function(d1, d2){return d1.col3 - d2.col3;});
            
            var group = function(d) {
                return (d.col4 < 2) ? 1 : 2;
            }
            
            var color = function(d) {
                return (group(d) == 1) ? 'blue' : 'red';
            }
            
            
            G['2'] = d4.graphic()
            .coord(d4.rect({x:'cat1',
                            // We don't redefine y, so it's default name will be 'y1'
                            // since 'y' is already taken by the sub-system
                            subSys: d4.rect()
                            }))
            .element({  cat1:'data:col1',
                        y1:'data:col2',
                        x:'data:col3',
                        y:'data:col4'})
            .line(  {   fill:'none',
                        stroke_width:3,
                        stroke:'green',
                        group:'data:col3',
                        stroke_dasharray:'5,5'})
            .symbol({   size:50,
                        fill:'white',
                        stroke:color,
                        stroke_width:2,
                        type:function(d){return group(d)==1 ? 'triangle-up' : 'triangle-down';}})
            .data({data:dataset})
            .processData({func:d4.filter({criteria:function(d){return d.col1!='B' || d.col2!=20;}})})
            .plot({selector:"#graph2", width:800, height:600, margin:30});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var dataset = [];
            
            var cat = ['cat A', 'cat B'];
            for(var i = 1 ; i <= 4 ; i++)
                for(var j = 0 ; j < 2 ; j++)
                    for(var k = 0 ; k < 30 ; k++)
                        dataset.push({col1:i, col2:cat[j], col3:Math.random()*100});
                        
                        
            G['3'] = d4.graphic()
            .coord(d4.rect({x:'cat',
                            y:null, // We don't want to use this dimension 
                            subSys: d4.rect({x:'sub_cat', y:'y'})
                            }))
            .symbol({cat:'data:col1',
                    sub_cat:'data:col2',
                    y:'data:col3',
                    fail:'FAIL',
                    size:1600,
                    //type:'square',
                    fill:function(d){return d.col2=='cat A'?'red':'blue';}
                    })
            .data({data:dataset})
            .plot({selector:"#graph3", width:1000, height:1000, margin:50});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var dataset = [];
            for(var t = 0 ; t < 20 ; t++)
                for(var i = 0 ; i < 20 ; i++)
                    dataset.push({col1:i, col2:t, col3:'v'+(i<10?'0':'')+i});
            
            
            G['4'] = d4.graphic()
            .coord(d4.polar())
            .time({t:'data:col2'})
            .symbol({   theta:'data:col3',
                        radius:function(d){return (d.col1+d.col2)%20;},
                        size:100,
                        type:'data:col1',
                        fill:'white',
                        stroke:'data:col1',
                        stroke_width:2})
            .data({data:d4.loadFromFile({file:'test.csv'})})
            .plot({selector:"#graph4", width:1024, height:768, margin:50});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            G['5'] = d4.graphic()
            .coord(d4.rect({subSys: d4.polar()}))
            .time({t:'data:col5'})
            .element({  x:'data:col1',
                        y: 'data:col2',
                        theta:function(d){return 'v'+d.col3},
                        radius:'data:col4'})
            .line({     fill:'none',
                        stroke:'red',
                        stroke_width:2,
                        interpolation:function (d) {if(d.col1=='A'&&d.col2=='C'){
                                                        return 'linear';
                                                    } else if(d.col1=='A'&&d.col2=='D') {
                                                        return 'cardinal';
                                                    } else if(d.col1=='B'&&d.col2=='C') {
                                                        return 'step';
                                                    } else if(d.col1=='B'&&d.col2=='D') {
                                                        return 'basis';
                                                    }}})
            .symbol({   fill:'data:col3',
                        type:'data:col4',
                        stroke:'black'})
            .on({event:'mouseover', listener:function(d, g) {
                                var id = d.col1+'-'+d.col2+'-'+d.col3+'-'+d.col4+'-'+d.col5;
                                var pos = d4.mouse(g);
                                
                                if(!d4.popupExist({id:id, graphic:g})) {
                                    d4.showPopup({id:'hover', graphic:g, position:pos, text:d.col3.toString()});
                                }
                            }})
            .on({event:'mouseout',  listener:function(d, g) {
                                d4.hidePopup({id:'hover', graphic:g, duration:500});
                            }})
            .on({event:'click',     listener:function(d, g) {
                                var id = d.col1+'-'+d.col2+'-'+d.col3+'-'+d.col4+'-'+d.col5;
                                var pos = d4.mouse(g);
                                
                                if(d4.popupExist({id:id, graphic:g})) {
                                    d4.hidePopup({id:id, graphic:g});
                                }
                                else {
                                    d4.showPopup({id:id, graphic:g, position:pos, text:d.col3.toString()});
                                    d4.hidePopup({id:'hover', graphic:g});
                                }
                            }})
            .data({data:d4.loadFromDatabase({   host:'localhost',
                                                dbname:'test_db',
                                                user:'user_test',
                                                pwd:'123456',
                                                request:'SELECT * FROM data_test'})})
            .plot({selector:'#graph5', width:1000, height:1000, margin_left:50, margin_bottom:40});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            G['6'] = d4.graphic()
            .time({t:function(d){return parseInt(d.vn6 * 100)}})
            .coord(d4.polar())
            .symbol({   theta:'data:bn6',
                        radius:'data:sn6',
                        fill:'white',
                        stroke_width:2,
                        stroke:function(d){return d.sn6 > 0.5 ? 'red' : 'blue'}})
            .data({data:d4.loadFromFile({file:'big.csv'})})
            .plot({selector:"#graph6", width:1024, height:768, margin:50});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var dataset = [];
            var cat = ['A', 'B', 'C', 'D', 'E', 'F'];
            for(var t = 0 ; t < 7 ; t++)
                for(var i = 0 ; i < cat.length ; i++)
                    for(var y = 0 ; y < 5 ; y++)
                        dataset.push({cat:cat[i], y:Math.random()*10, t:t});
            
            G['7-1'] = d4.graphic()
            .coord(d4.polar({theta:'dim1', radius:'dim2'}))
            .time({t:'data:t'})
            .bar({  dim1:'data:cat',
                    dim2:d4.interval.stack('data:y'),
                    group:'data:cat',
                    stroke:'black',
                    fill:function(d,i){return i;}})
            .data({data:dataset})
            .plot({selector:"#graph7-1", width:600, height:600, margin:30});
            
            G['7-2'] = d4.graphic()
            .coord(d4.polar({theta:'dim2', radius:'dim1'}))
            .time({t:'data:t'})
            .bar({  dim1:'data:cat',
                    dim2:d4.interval.stack('data:y'),
                    group:'data:cat',
                    stroke:'black',
                    fill:function(d,i){return i;}})
            .data({data:dataset})
            .plot({selector:"#graph7-2", width:600, height:600, margin:30});
                        
            G['7-3'] = d4.graphic()
            .coord(d4.rect({x:'dim1', y:'dim2'}))
            .time({t:'data:t'})
            .bar({  dim1:'data:cat',
                    dim2:d4.interval.stack('data:y'),
                    group:'data:cat',
                    fill:function(d,i){return i;}})
            .data({data:dataset})
            .plot({selector:"#graph7-3", width:600, height:600, margin:30});
            
            G['7-4'] = d4.graphic()
            .coord(d4.rect({x:'dim1', y:null,
                            subSys:d4.rect({x:'sub_cat', y:'dim2'})}))
            .time({t:'data:t'})
            .bar({  dim1:'data:cat',
                    dim2:d4.interval(0, 'data:y'),
                    sub_cat:function(d,i){return i;},
                    //group:'data:cat',
                    fill:function(d,i){return i;}})
            .data({data:dataset})
            .plot({selector:"#graph7-4", width:600, height:600, margin:30});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var dataset = [];
            var cat = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
            for(var i = 1 ; i < 20 ; i++)
                for(var j = 0 ; j < cat.length ; j++)
                    dataset.push({x:cat[j], y:i});
            
            G['8'] = d4.graphic()
            .time({ tx:'data:x',
                    ty:'data:y'})
            .symbol({   x:'data:x',
                        y:'data:y',
                        fill:'red',
                        stroke:'black'})
            .data({data:dataset})
            .processData({func:d4.filter({criteria:function(d){return d.y <= 10;}})})
            .plot({selector:"#graph8", width:600, height:600, margin:50});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var dataset = [];
            var cat = ['A', 'B', 'C', 'D', 'E'];
            for(var t = 0 ; t < 10 ; t++)
                for(var i = 0 ; i < cat.length ; i++)
                    for(var j = 0 ; j < 100 ; j++)
                        dataset.push({cat:cat[i], value:Math.random()*100, t:t});
            
            G['8'] = d4.graphic()
            .coord(d4.rect({  x:     'dim1', y:     'dim2'}))
            //.coord(d4.rect({  y:     'dim1', x:     'dim2'}))
            //.coord(d4.polar({ theta: 'dim1', radius:'dim2'}))
            //.coord(d4.polar({ radius:'dim1', theta: 'dim2'}))
            //.coord(d4.rect({  x:     null,   y:     'dim2'}))
            //.coord(d4.rect({  x:     'dim2', y:     null  }))
            //.coord(d4.polar({ theta: null,   radius:'dim2'}))
            //.coord(d4.polar({ theta: 'dim2', radius:null}))
            .time({t:'data:t'})
            .element({  dim1:'data:categorie',
                        fill:'white',
                        stroke:'black',
                        stroke_width:1.5})
            .boxplot({  dim2:d4.boxplotStat()})
            //.symbol({   dim2:'data:quartile2'})
            .data({data:dataset})
            //.processData({func:d4.filter({criteria:function(d){return d.cat=='A'}})})
            .processData({func:d4.computeBoxPlotStat({  group_by:{  categorie:function(d){return d.cat;},
                                                                    t:'data:t'},
                                                        stat_on:'data:value'})})
            .plot({selector:"#graph9", width:1024, height:768, margin:50});
            
            /*
            .boxplot({data: filter("toto", function(){}),  dim2:d4.boxplotStat()})
            .symbol({data: filter(function(d, g){ bpData = getDataSet("toto");  }), 
            .text({data: get("toto"), label: 'data:median', x: 'x', y: 'median')
            */
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            function prev(i) {
                G[i].previousStep('t');
            }
            
            function next(i) {
                G[i].nextStep('t');
            }
            
        </script>
    </head>
    <body>
        <div id="graph1"></div>
        
        <div id="graph2"></div>
        
        <div id="graph3"></div>
        
        <div id="graph4"></div>
        <input type="button" value="Previous" onclick="prev('4')"/>
        <input type="button" value="Next" onclick="next('4')"/>
        
        <div id="graph5"></div>
        <input type="button" value="Previous" onclick="prev('5')"/>
        <input type="button" value="Next" onclick="next('5')"/>
        
        <div id="graph6"></div>
        <input type="button" value="Previous" onclick="prev('6')"/>
        <input type="button" value="Next" onclick="next('6')"/>
        
        <table>
            <tr>
                <td id="graph7-1"></td>
                <td id="graph7-2"></td> 
            </tr>
            <tr>
                <td id="graph7-3"></td>
                <td id="graph7-4"></td> 
            </tr>
        </table>
        <input type="button" value="Previous" onclick="prev('7-1');prev('7-2');prev('7-3');prev('7-4')"/>
        <input type="button" value="Next" onclick="next('7-1');next('7-2');next('7-3');next('7-4')"/>
        
        <div id="graph8"></div>
        
        <div id="graph9"></div>
    </body>
</html>   
